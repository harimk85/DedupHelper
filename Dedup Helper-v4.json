{"appVersion":"252.0.22","id":"vq5npu7vrm","name":"Dedup Helper","version":4,"modelVersion":"6","references":{"dataExtensions/115c2c04-60b8-ef11-ba5c-f40343e97c48":[{"identifier":"categories/24827","relationship":"required"}],"dataExtensions/2f4c4abf-61b8-ef11-ba5c-f40343e97c48":[{"identifier":"categories/24827","relationship":"required"}],"categories/24827":[{"identifier":"categories/10046","relationship":"required"}],"categories/10046":[],"cloudPageCollections/25856":[{"identifier":"categories/25856","relationship":"required"},{"identifier":"categories/10081","relationship":"required"}],"categories/25856":[{"identifier":"categories/10081","relationship":"required"}],"categories/10081":[],"landingPages/1873876-564":[{"identifier":"primaryLandingPages/1873876-564","relationship":"required"},{"identifier":"categories/10062","relationship":"required"}],"landingPages/1873880-565":[{"identifier":"primaryLandingPages/1873880-565","relationship":"required"},{"identifier":"categories/10062","relationship":"required"}],"primaryLandingPages/1873876-564":[{"identifier":"cloudPageCollections/25856","relationship":"required"},{"identifier":"categories/10062","relationship":"required"}],"primaryLandingPages/1873880-565":[{"identifier":"cloudPageCollections/25856","relationship":"required"},{"identifier":"categories/10062","relationship":"required"}],"categories/10062":[]},"input":[{"key":"cloudPages-domain","type":"entityPicker","label":"FIELD_DEFINITION_CLOUDPAGES_DOMAIN","meta":{"entityType":"cloudpagesDomain"},"isSystem":true,"entities":["primaryLandingPages/1873876-564","primaryLandingPages/1873880-565"]}],"config":{"preserveCategories":true,"storeImagesAsReferences":false},"entities":{"assets":{},"attributeGroups":{},"attributeRelationships":{},"attributeSets":{},"automations":{},"categories":{"10046":{"issues":[],"originID":"10046","originEID":"client_base_url","data":{"description":"","categoryType":"dataextension","parentId":0,"name":"Data Extensions","editable":0,"extendable":1}},"10062":{"issues":[],"originID":"10062","originEID":"client_base_url","data":{"description":"The root folder for assets","categoryType":"asset","parentId":0,"name":"Content Builder","editable":0,"extendable":1}},"10081":{"issues":[],"originID":"10081","originEID":"client_base_url","data":{"description":"The root folder for CloudPages","categoryType":"cloudpages","parentId":0,"name":"CloudPages","editable":0,"extendable":1}},"24827":{"issues":[],"originID":"24827","originEID":"client_base_url","data":{"description":"","categoryType":"dataextension","parentId":"{{mcpm#/entities/categories/10046/data/id}}","name":"SFMC System","editable":1,"extendable":1}},"25856":{"issues":[],"originID":"25856","originEID":"client_base_url","data":{"description":"","categoryType":"cloudpages","parentId":"{{mcpm#/entities/categories/10081/data/id}}","name":"Dedup Helper","editable":1,"extendable":0}}},"cloudPageCollections":{"25856":{"issues":[],"originID":"25856","originEID":"client_base_url","data":{"name":"Dedup Helper","description":"","parentId":"{{mcpm#/entities/categories/10081/data/id}}","parentName":"{{mcpm#/entities/categories/10081/data/name}}"}}},"codeResources":{},"dataExtensions":{"115c2c04-60b8-ef11-ba5c-f40343e97c48":{"issues":[],"originID":"115c2c04-60b8-ef11-ba5c-f40343e97c48","originEID":"client_base_url","data":{"categoryId":"{{mcpm#/entities/categories/24827/data/id}}","dataRetentionProperties":{"dataRetentionPeriodUnitOfMeasure":3,"dataRetentionPeriodLength":7,"isDeleteAtEndOfRetentionPeriod":false,"isResetRetentionPeriodOnImport":false,"isRowBasedRetention":true,"rowBasedThreshold":2147483647},"description":"","isFieldAdditionAllowed":true,"isFieldModificationAllowed":true,"isObjectDeletable":true,"isSendable":false,"isTestable":false,"name":"DedupHelperAuthLog","fields":[{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":false,"isPrimaryKey":true,"isReadOnly":false,"isTemplateField":false,"length":50,"masktype":"None","mustOverride":false,"name":"session","ordinal":0,"type":"Text"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":100,"masktype":"None","mustOverride":false,"name":"appName","ordinal":1,"type":"Text"},{"defaultValue":"GetDate()","description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"masktype":"None","mustOverride":false,"name":"createdDate","ordinal":2,"type":"Date"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":520,"masktype":"None","mustOverride":false,"name":"token","ordinal":3,"type":"Text"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"masktype":"None","mustOverride":false,"name":"tokenExpire","ordinal":4,"type":"Date"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":100,"masktype":"None","mustOverride":false,"name":"userName","ordinal":5,"type":"Text"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":254,"masktype":"None","mustOverride":false,"name":"userEmail","ordinal":6,"type":"Text"}]}},"2f4c4abf-61b8-ef11-ba5c-f40343e97c48":{"issues":[],"originID":"2f4c4abf-61b8-ef11-ba5c-f40343e97c48","originEID":"client_base_url","data":{"categoryId":"{{mcpm#/entities/categories/24827/data/id}}","dataRetentionProperties":{"isDeleteAtEndOfRetentionPeriod":false,"isResetRetentionPeriodOnImport":false,"isRowBasedRetention":false,"rowBasedThreshold":1000000000},"description":"","isFieldAdditionAllowed":true,"isFieldModificationAllowed":true,"isObjectDeletable":true,"isSendable":false,"isTestable":false,"name":"DedupErrorLog","fields":[{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":false,"isPrimaryKey":true,"isReadOnly":false,"isTemplateField":false,"length":36,"masktype":"None","mustOverride":false,"name":"id","ordinal":0,"type":"Text"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":100,"masktype":"None","mustOverride":false,"name":"appName","ordinal":1,"type":"Text"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":2000,"masktype":"None","mustOverride":false,"name":"errorMessage","ordinal":2,"type":"Text"},{"description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"length":2000,"masktype":"None","mustOverride":false,"name":"errorDescription","ordinal":3,"type":"Text"},{"defaultValue":"GetDate()","description":"","isHidden":false,"isInheritable":false,"isOverridable":false,"isNullable":true,"isPrimaryKey":false,"isReadOnly":false,"isTemplateField":false,"masktype":"None","mustOverride":false,"name":"errorDate","ordinal":4,"type":"Date"}]}}},"dataExtractActivities":{},"dataFilterDefinitions":{},"dataFilters":{},"eventDefinitions":{},"fileTransferActivities":{},"importActivities":{},"journeys":{},"journeyTemplates":{},"landingPages":{"1873876-564":{"issues":[{"type":"UNSUPPORTED_AMPSCRIPT","level":"INFO","sourceJobType":"PACKAGE","issue":"UNRESOLVED_VARIABLE"}],"originID":"1873876-564","originEID":"client_base_url","data":{"asset":{"assetType":{"id":205,"name":"webpage"},"name":"DedupHelper (5)","category":{"id":"{{mcpm#/entities/categories/10062/data/id}}"},"contentType":"text/html","meta":{"globalStyles":{"isLocked":false,"body":{"max-width":"1280px"}}},"views":{"html":{"thumbnail":{},"content":"%%[\nVAR @secondQans, @secondQchoiceOne, @secondQchoiceTwo, @MessageStep1, @MessageStep2\nSET @DEfound = RequestParameter(\"DEfound\")\nSET @secondQans = RequestParameter(\"secondQ\")\nSET @session = RequestParameter(\"state\")\n]%%\n<script runat=\"server\">\n    /* -------------------------------------------------------------------------\n\n    Authenticates each visitor to limit access only to SFMC logged-in users.\n\n    1. Global Variables\n    2. Helper Functions\n        2.1. Debugging\n        2.2. Error handling\n    3. Authentication Flow\n        3.1. Authorisation\n        3.2. Authentication with REST Token\n            3.2.1. Build token request payload\n            3.2.2. Request the token\n            3.2.3. Destructure the response\n            3.2.4 Get User Details\n            3.2.5. Upsert Logging Data Extension\n            3.2.6. Handle authentication error\n        3.3. Authorisation Error\n\n    -------------------------------------------------------------------------- */\n\n    Platform.Load('core', '1');\n\n    /* ----------------------------------------------------------------------- */\n    /* ---------------------- 1. GLOBAL VARIABLES ---------------------------- */\n    /* ----------------------------------------------------------------------- */\n    var method = Platform.Request.Method();\n\n    var debugging = false;\n    var appName = 'Dedup Helper';\n    var appURL = 'https://cloud.recruiting.stepstone.de/DedupHelper-v4';\n\n    var clientID = 'client_id';\n    var clientSecret = 'client_secret';\n    var clientBase = 'client_base_url';\n    var authDE = 'DedupHelperAuthLog';\n\n    var state = Platform.Request.GetQueryStringParameter('state');\n    Variable.SetValue(\"@session\",state);\n\n    var errorMessage = Platform.Request.GetQueryStringParameter('error');\n    var errorDescription = Platform.Request.GetQueryStringParameter('error_description');\n    var errorDE = 'DedupErrorLog';\n    var errorURL = 'https://cloud.recruiting.stepstone.de/DedupErrorHandler';\n\n    /* ----------------------------------------------------------------------- */\n    /* ---------------------- 2. HELPER FUNCTIONS ---------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* ---------------------- 2.1. Debugging --------------------------------- */\n\n    /**\n    * @function debugValue\n    * @description Outputs provided description and SSJS value to front-end in a type-safe & consistent way\n    * @param {string} description - Describes meaning of the second parameter in the output\n    * @param {*} value - The value that needs to be debugged\n    */\n    function debugValue(description, value) {\n        Write(description + ': ' + (typeof value == 'object' ? Stringify(value) : value) + '<br><br>');\n    };\n\n    /* ---------------------- 2.2. Error handling ---------------------------- */\n\n    /**\n    * @function handleError\n    * @description Adds the error with context to error logging Data Extension and redirects to error page.\n    * @param {Object} error - The caught error object. Can come from the try/catch block or be manually created.\n    * @param {string} error.message - First error key stores short error message describing the issue.\n    * @param {string} error.description - Second error key stores detailed error path helping with root cause analysis\n    */\n    function handleError(error) {\n        if (debugging) {\n            debugValue('Found error', error);\n        } else {\n            // Remember that if your Logging Data Extension is in Shared Folder, you need to add the \"ENT.\" prefix to name\n            Platform.Function.InsertData(errorDE, ['id', 'appName', 'errorMessage', 'errorDescription'], [GUID(), appName, error.message, error.description]);\n            Platform.Response.Redirect(errorURL + '?error=' + error.message + '&error_description=' + error.description);\n        };\n    };\n  \n    if (method == 'GET') {\n\n        /* ----------------------------------------------------------------------- */\n        /* ---------------------- 3. AUTHENTICATION FLOW ------------------------- */\n        /* ----------------------------------------------------------------------- */\n\n        /* ---------------------- 3.1. Authorization ----------------------------- */\n        if (!state && !errorMessage) {\n            state = GUID();\n            Platform.Response.Redirect('https://' + clientBase + '.auth.marketingcloudapis.com/v2/authorize?response_type=code&client_id=' + clientID + '&redirect_uri=' + appURL + '&state=' + state);\n\n            /* ---------------------- 3.2. Authentication ---------------------------- */\n\n        } else if (state && !errorMessage) {\n            /* 3.2.1. Build token request payload */\n            var code = Platform.Request.GetQueryStringParameter('code');\n            var payload = {\n                grant_type: 'authorization_code',\n                code: code,\n                client_id: clientID,\n                client_secret: clientSecret,\n                redirect_uri: appURL\n            };\n            /* 3.2.2. Request the token */\n            var response = HTTP.Post('https://' + clientBase + '.auth.marketingcloudapis.com/v2/token', 'application/json', Stringify(payload));\n            /* 3.2.3. Destructure the response */\n            if (response.StatusCode == 200) {\n                var parsedResponse = Platform.Function.ParseJSON(response.Response[0]);\n                var accessToken = parsedResponse.access_token;\n                var tokenExpire = Platform.Function.SystemDateToLocalDate(Platform.Function.Now());\n                tokenExpire.setMinutes(tokenExpire.getMinutes() + 18);\n\n                /* 3.2.4. Get User Details */\n                response = HTTP.Get('https://' + clientBase + '.auth.marketingcloudapis.com/v2/userinfo', ['Authorization'], ['Bearer ' + accessToken]);\n                if (debugging) debugValue('UserInfo Response', response)\n                userName = Platform.Function.ParseJSON(response.Content).user.name;\n                userEmail = Platform.Function.ParseJSON(response.Content).user.email;\n\n                /* 3.2.5. Upsert Authentication Logging Data Extension */\n                Platform.Function.UpsertData(authDE, ['session'], [state],\n                    ['appName', 'token', 'tokenExpire', 'userName', 'userEmail'],\n                    [appName, accessToken, tokenExpire, userName, userEmail]\n                );\n\n\n                /* 3.2.6. Handle authentication error */\n            } else {\n                handleError({ message: 'Authentication Failed', description: 'Status: ' + response.StatusCode })\n            };\n\n            /* ---------------------- 3.3. Authorization Error ----------------------- */\n\n        } else {\n            handleError({ message: errorMessage, description: errorDescription });\n        };\n      } else if (method == 'POST') {\n            /* 4.2.1 Get session code from POST url */\n            var session = Request.GetQueryStringParameter(\"state\"); \n            /* 4.2.2. Check whether there is a matching token for the session */\n            var token = Platform.Function.Lookup(authDE, 'token', ['appName', 'session'], [appName, session]);\n            var tokenExpire = Platform.Function.Lookup(authDE, 'tokenExpire', ['appName', 'token'], [appName, token]);\n            /* 4.2.3. If no valid token, return error */\n            if (Platform.Function.SystemDateToLocalDate(Platform.Function.Now()) > tokenExpire) {\n                handleError({ message: 'Session Timeout', description: 'The token is expired. Please refresh the session to use the application.' });\n            };        \n      }\n</script>\n\n<!-- The Cloud Page App micro SSO solution will secure anything you create below -->\n\n<script runat=\"server\">\n  Platform.Load(\"core\",\"1\");\n  var DEfound = false;\n  var secondQans = Variable.GetValue(\"@secondQans\");\n                         \n  // Check if the form is submitted  \n  if (method == \"POST\" && !DEfound && !secondQans) { \n    var message = '';\n    var DEprop = Request.GetQueryStringParameter(\"DEprop\");\n    var DEval = Request.GetQueryStringParameter(\"DEval\");\n    var FindDE = DataExtension.Retrieve({Property:DEprop,SimpleOperator:\"equals\",Value:DEval});\n    \n    if(FindDE.length == 1){\n      message += 'Your Filtered DE is located at: ';\n    } else if(FindDE.length > 1){\n      message += 'We have found more than one DE with the same name, please enter the correct name of your DE & click on locate button <br><br>';\n      message += 'The location of your ' + FindDE.length + ' Data Extensions are below: <br><br>';\n    } else {\n      message += 'Sorry a DE with that name does not exist, please re-check your entry'; \n    };  \n    \n    for (var i = 0; i < FindDE.length; i++) {\n      var FolderID = FindDE[i].CategoryID;\n      var FilterDEFolderUrl = 'https://mc.s51.exacttarget.com/cloud/#app/Email/C12/Default.aspx?entityType=none&entityID=0&ks=ks%23Subscribers/CustomObjects/'+FolderID;\n      var DEname = FindDE[i].Name;\n      var DEobjectId = FindDE[i].ObjectID;\n\n      Variable.SetValue(\"@FolderID\",FolderID);\n      Variable.SetValue(\"@FolderUrl\",FilterDEFolderUrl);\n      Variable.SetValue(\"@DEname\",DEname);\n      Variable.SetValue(\"@DEobjectId\",DEobjectId);\n\n      if (FindDE.length == 1) {\n        var newDEName = DEname+'_Dedup_' + formatDate(new Date());\n        Variable.SetValue(\"@newDEName\",newDEName);\n        DEfound = true;\n        Variable.SetValue(\"@DEfound\",DEfound);\n        var list = getFolderPath(DEname, FolderID);   \n        if (list.length > 1){\n          message += list.join(\"> \") +'<br><br><br>';\n        }\n      } else if (FindDE.length > 1) {\n        var list = getFolderPath(DEname, FolderID);                         \n        if (list.length > 1){\n          var deNum = +i +1;\n          message += 'DE '+ deNum +' is located at: ';\n          message += list.join(\"> \") +'<br><br><br>';\n        }                                    \n      };\n    };  \n    \n    Variable.SetValue(\"@MessageStep1\",message);\n  }\n  \n  if (Request.Method == \"POST\" && secondQans == \"answered\") {\n    var message = '';\n    var objectId = Request.GetQueryStringParameter(\"DEobjectId\");\n    var newDEName = Request.GetQueryStringParameter(\"newDEName\"); \n    var FolderID = Request.GetQueryStringParameter(\"FolderID\");\n    var DEname = Request.GetQueryStringParameter(\"DEname\"); \n    var FolderUrl = Request.GetQueryStringParameter(\"FolderUrl\");\n    Variable.SetValue(\"@FolderUrl\",FolderUrl);\n \n\n    //Find Filtered DE fields\n    var FindDE = DataExtension.Retrieve({Property:\"Name\",SimpleOperator:\"equals\",Value:DEname});\n    var DEcustomerKey = FindDE[0].CustomerKey;\n    var isSendable = FindDE[0].IsSendable;                             \n    var sendableDEField = FindDE[0].SendableDataExtensionField;\n    var sendableSubField = FindDE[0].SendableSubscriberField;                   \n\n    message += '<br><br><br>';\n    message +='<b>Helpful Information</b>';\n    message +='<br><br><br>';\n    \n    var prox = new Script.Util.WSProxy();\n    prox.setClientId({\"ID\": Platform.Function.AuthenticatedMemberID()});                            \n    var DE = DataExtension.Init(DEcustomerKey);\n    var custKeyOfExistingDE = dataExtensionExists(newDEName);\n    if (custKeyOfExistingDE) {\n      deleteDE(custKeyOfExistingDE);\n    }            \n    var fields = DE.Fields.Retrieve();\n    for(var i = 0; i < fields.length; i++) {\n      if(fields[i]['IsPrimaryKey'] == true ) fields[i]['IsRequired'] = true;\n    }\n    var NewCustomerKey = Platform.Function.GUID();\n    var ClonedDE = {\n      'CustomerKey' : NewCustomerKey,\n      'Name' : newDEName,\n      'CategoryID': FolderID,\n      'IsSendable': isSendable,\n      'Fields' : fields,\n      'DataRetentionPeriodLength': 60,\n      'DataRetentionPeriod': 'Days',\n      'RowBasedRetention': false,\n      'ResetRetentionPeriodOnImport': true,                                \n      'SendableDataExtensionField' : sendableDEField,\n      'SendableSubscriberField' : {\"Name\": \"Subscriber Key\"}\n    }\n    \n    var res = prox.createItem(\"DataExtension\", ClonedDE);\n    if(res.Results[0].StatusCode == \"OK\"){\n      message += '<i>The name of your deduplicated DE is:</i> \\n\\n' + newDEName +'<br><br>'; \n      message += '<i>You can find this DE at the <a href=\"'+FolderUrl+'\" target=\"_blank\">folder</a> location:</i> \\n\\n'; \n      var list = getFolderPath(newDEname, FolderID);                        \n      if (list.length > 1){ \n         message += list.join(\"> \") + '<br><br>';\n      }                                \n    } else {\n      message += res.Results[0].StatusCode + \": \" + res.Results[0].StatusMessage;;\n    }\n\n    /* Create and run SQL query to dedup DE */\n    var dedupQueryKey = Platform.Function.GUID();\n    var selectQueryParams = getQueryParams(fields, 'x.');\n    var selectFromFields =  getQueryParams(fields);\n    var dedupQuery = \"SELECT  \" + selectQueryParams + \" FROM (SELECT ROW_NUMBER() OVER (partition by <<FieldNameContainingEmail>> ORDER BY  CONVERT(DATETIME2, <<FieldNameContainingAnyDateField>>) DESC) AS NewRowNumber, \" + selectFromFields + \" FROM [\" + DEname + \"]) x WHERE x.NewRowNumber = 1\";\n\n    var createStatus = createQuery(dedupQueryKey, dedupQuery, NewCustomerKey,'Update');\n    \n    if(createStatus.Status == \"OK\"){\n      message += '<i>We are ready to launch the SQL query to deduplicate your filtered DE..</i> <br><br>';\n    } else {\n      message += '(+) Query create ' + Platform.Function.Stringify(createStatus) + '<br><br>';\n    }\n    \n    var queryObjectID = createStatus.Results[0].NewObjectID;\n    var performStatus = performQuery(queryObjectID);\n    \n    if(performStatus.Status == \"OK\"){\n      message += '<i>Query is running now. Please wait a couple of minutes for it to finish. You shall see deduplicated records in the '+newDEName+' soon</i> <br><br>';\n    }else{\n      message += '(+) Query perform ' + Platform.Function.Stringify(performStatus) + '<br><br>';\n    }                            \n    //sleep(30000); // wait for query to finish\n    //var removeStatus = removeQuery(queryObjectID);\n    //Write('(+) Query remove ' + Platform.Function.Stringify(removeStatus) + '\\n\\n');\n    Variable.SetValue(\"@MessageStep2\",message);\n  }\n  \n\n  /* Creates a date string in ddmmyyyy format */\n  function formatDate(date) {\n    var d = new Date(date), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();\n    if (month.length < 2) month = '0' + month;\n    if (day.length < 2) day = '0' + day;\n    var formattedDate = day + month + year;\n    return formattedDate\n  } \n  \n  //Get the DE folder path\n  function getFolderPath(DEname, FolderID){\n    var list = [];\n    var path = function(id) {\n      if (id > 0) {\n        var results = Folder.Retrieve({Property:\"ID\",SimpleOperator:\"equals\",Value:id});\n        list.unshift(results[0].Name);\n        return path(results[0].ParentFolder.ID);\n      }\n      else {\n        return id;\n      }\n    }\n    list.push(DEname);\n    path(FolderID);\n    return list;\n  } \n  \n   /* Create a query using WSProxy */\n  function createQuery(queryKey, queryText, targetDEKey, targetUpdateType) {\n    var queryConfig = {\n      Name: queryKey,\n      CustomerKey: queryKey,\n      TargetUpdateType: targetUpdateType,\n      TargetType: 'DE',\n      DataExtensionTarget: {\n        Name: targetDEKey,\n        CustomerKey: targetDEKey\n      },\n      QueryText: queryText\n    };\n    var status = prox.createItem('QueryDefinition', queryConfig);\n    return status;\n  }\n  /* Perform a query using WSProxy (ObjectID is needed) */\n  function performQuery(queryObjID) {\n    var prox = new Script.Util.WSProxy();\n    var props = {\n      ObjectID: queryObjID\n    };\n    var action = 'Start';\n    var opts = {};\n    var status = prox.performItem('QueryDefinition', props, action, opts);\n    return status;\n  }  \n  /* Remove a query using WSProxy (ObjectID is needed) */\n  function removeQuery(queryObjID) {\n    var prox = new Script.Util.WSProxy();\n    var props = {\n      ObjectID: queryObjID\n    };\n    var status = prox.deleteItem('QueryDefinition', props);\n    return status;\n  }          \n  /* Wait function */\n  function sleep(milliseconds) {\n    var start = new Date().getTime();\n    for (var i = 0; i < 1e7; i++) {\n      if (new Date().getTime() - start > milliseconds) {\n        break;\n      }\n    }\n  } \n  /* Delete a DE (using customer key) */\n  function deleteDE(deleteDECustomerKey){\n    var prox = new Script.Util.WSProxy();\n    var req = prox.retrieve(\"DataExtension\", [\"ObjectID\"], {\n      Property: \"DataExtension.CustomerKey\", SimpleOperator: \"equals\", Value: deleteDECustomerKey }\n                           );\n    var objectId = req.Results[0].ObjectID;\n    var result = prox.deleteItem(\"DataExtension\", {\n      \"ObjectID\": objectId });    \n  }  \n  /* Check whether a DE with same name exists already(using DE name) */\n  function dataExtensionExists(deName){\n    var findExistingDE = DataExtension.Retrieve({\n      Property:\"Name\",SimpleOperator:\"equals\",Value:deName}\n                                               );\n    //Write(\"Found Existing DE: \"+Stringify(findExistingDE)+ \"<br>\");\n    if (findExistingDE[0].CustomerKey.length > 0){\n      //Write(\"DE cust key: \"+findExistingDE[0].CustomerKey+ \"<br>\");\n      return findExistingDE[0].CustomerKey;\n    }\n  }\n\n  // Helper function to build the select query \n  // param fields - array of results return by DE.Fields.Retrieve();\n  // param prefix - an optional string to be added before each field nameield name\n  // return all the fields name from the DE as a single string like \"field1, field2, field3\"\n  function getQueryParams(fields, prefix){\n    if (fields && fields.length){\n      var params = [];\n      var prefix = (typeof prefix === \"string\" && prefix) || '';\n      for(var i=0; i < fields.length; i++){\n        if(fields[i].Name) params.push(prefix + fields[i].Name);\n      }\n      return params.join(',');\n    } \n  }\n</script>\n\n<!DOCTYPE html> \n<html>\n<head>\n <meta http-equiv=\"Cache-Control\" content=\"no-store,no-cache, must-revalidate,post-check=0, pre-check=0,max-age=0\">\n      <meta http-equiv=\"Pragma\" content=\"no-cache\">\n      <meta http-equiv=\"Expires\" content=\"0\">\n      <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n      <meta name=\"sg:pagetag\" content=\"\">\n      <meta name=\"sg:flowtag\" content=\"\">\n      <meta charset=\"utf-8\">\n      <title>Stepstone.de</title>\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n      <!--<link rel=\"icon\" type=\"image/x-icon\" href=\"images/stepstone.ico\">-->\n      <!-- Bootstrap CSS -->\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\"> \n      <!-- Custom css -->\n<link rel=\"stylesheet\" href=\"https://client_base_url.pub.sfmc-content.com/kdfrm3ji4h3\">\n<link rel=\"stylesheet\" href=\"https://client_base_url.pub.sfmc-content.com/hulsf24n4ub\">\n  \n  <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/styles/salesforce-lightning-design-system.min.css?v=1\">\n  <link rel=\"stylesheet\" type=\"text/css\" href=\"mc/css/styles.css?v=1\">\n<style>\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n</style>  \n</head>\n<body class=\"d-flex flex-column vh-100\">\n      <div id=\"spinner-overlay\" style=\"display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;\">\n        <div style=\"border: 8px solid #f3f3f3; border-top: 8px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;\"></div>\n      </div>  \n      <main class=\"flex-shrink-0\" lang=\"en\">\n         <div class=\"container\">\n            <div class=\"row\">\n               <div class=\"col-md-8 plr-16\">\n                  <table style=\"padding: 20px;\">\n                    <tr>\n                      <td>\n                        <h2>Dedupliction tool</h2>\n                        <br>\n                        <b>Perform the following 2 steps to generate your target Data Extension, deduplicated based on Email Address\n                        </b><br><br>\n                        %%[IF @secondQans == \"answered\" THEN]%%\n                        <b>Step 1: Completed!\n                        </b>                        \n                        %%[ELSE]%%\n                        <b>Step 1: Please enter the name or external key key of the Filtered DE you wish to deduplicate & hit the 'Locate' button\n                        </b>\n                        <br><br>                                                \n                        <form action=\"%%=RedirectTo(CONCAT(CloudPagesURL(560),'?state=',@session))=%%\" method=\"post\">\n                          <select name=\"DEprop\">\n                            <option value=\"Name\">Name</option>      \n                            <option value=\"CustomerKey\">External Key</option>\n                          </select>\n                          equals\n                          <input type=\"text\" name=\"DEval\" value=\"\" maxlength=\"128\">\n                          <br><br>\n                          <input type=\"submit\" value=\"Locate\">\n                        </form>\n                        %%[ENDIF]%%\n                        <br> \n                        %%=v(@MessageStep1)=%%\n                          %%[IF @DEfound == \"true\" AND @secondQans != \"answered\" THEN]%%\n                              <b>Step 2: Have you refreshed your Data Extension: '%%=v(@DEname)=%%' lately? If not please go to the <a href=\"%%=RedirectTo(@FolderUrl)=%%\" target=\"_blank\">folder</a> location & refresh the filtered Data Extension. Once done please hit the 'Proceed' button to create your deduplicated Data Extension\n                              </b><br><br>                                                \n                              <form action=\"%%=RedirectTo(CONCAT(CloudPagesURL(560),'?state=',@session))=%%\" method=\"post\" id=\"secondForm\">\n                                <input type=\"hidden\" name=\"secondQ\" value=\"answered\" />\n                                <input type=\"hidden\" name=\"DEfound\" value=\"true\" />\n                                <input type=\"hidden\" name=\"FolderUrl\" value=\"%%=v(@FolderUrl)=%%\" />\n                                <input type=\"hidden\" name=\"DEobjectId\" value=\"%%=v(@DEobjectId)=%%\" />\n                                <input type=\"hidden\" name=\"FolderID\" value=\"%%=v(@FolderID)=%%\" />\n                                <input type=\"hidden\" name=\"newDEName\" value=\"%%=v(@newDEName)=%%\" />\n                                <input type=\"hidden\" name=\"DEname\" value=\"%%=v(@DEname)=%%\" />\n                                <input type=\"submit\" value=\"Proceed\" id=\"proceedButton\">                                \n                              </form>                          \n                         %%[ENDIF]%%\n                         %%[IF @DEfound == \"true\" AND @secondQans == \"answered\" THEN]%%\n                          <br><br> \n                          <b>Step 2: We are proceeding with the deduplication exercise\n                          </b><br><br>                                                                      \n                         %%[ENDIF]%%   \n                         %%=v(@MessageStep2)=%%\n                      </td>\n                    </tr>\n                  </table>\n               </div>\n            </div>\n         </div>\n      </main>\n<!-- Spinner JS -->\n<script>\n  document.getElementById('proceedButton').addEventListener('click', function (event) {\n    // Display the spinner overlay\n    document.getElementById('spinner-overlay').style.display = 'flex';\n  });\n</script>   \n</body>\n</html>\n","meta":{},"slots":{"col1":{"design":"<p style=\"font-family:arial;color:#ccc;font-size:11px;text-align:center;vertical-align:middle;font-weight:bold;padding:10px;margin:0;border:#ccc dashed 1px;\">Drop blocks or content here</p>","modelVersion":2}},"modelVersion":2}}},"content":{"channelTypeId":3,"contentType":"text/html","isDefault":true,"isStaticContent":false,"name":"DedupHelper","siteId":"{{mcpm#/entities/primaryLandingPages/1873876-564/data/definition/landingPageId}}"},"name":"DedupHelper","primaryId":"{{mcpm#/entities/primaryLandingPages/1873876-564/data/id}}","state":{"contentType":"text/html","description":"","name":"DedupHelper","siteId":"{{mcpm#/entities/primaryLandingPages/1873876-564/data/definition/landingPageId}}"}}},"1873880-565":{"issues":[],"originID":"1873880-565","originEID":"client_base_url","data":{"asset":{"assetType":{"id":205,"name":"webpage"},"name":"Unauthorized (1)","category":{"id":"{{mcpm#/entities/categories/10062/data/id}}"},"contentType":"text/html","meta":{"globalStyles":{"isLocked":false,"body":{"max-width":"1280px","color":"#000000","font-family":"Arial","font-size":"12px","margin":"0px auto"},"template":{"background-color":"#FFFFFF","border":"none","box-sizing":"border-box","padding":"0px","width":"100%"},"buttons":{},"h1":{},"h2":{},"h3":{},"links":{}}},"views":{"html":{"thumbnail":{},"content":"<!DOCTYPE html>\n<html>\n<head>\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0\" />\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\t<style class=\"main_style\">\n.layout-canvas-g {\n  background-color: #fff;\n  border: none;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  padding: 0;\n  width: 100%;\n}\n.layout-canvas-g > .header,\n.layout-canvas-g > .section,\n.layout-canvas-g > .footer {\n  position: relative;\n  overflow: hidden;\n  width: 100%;\n  word-wrap: break-word;\n}\n.layout-canvas-g > .section {\n  margin: 10px 0;\n}\n.layout-canvas-g > .section > .columns {\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  word-wrap: break-word;\n}\nbody {\n  color: #000;\n  font-family: Arial;\n  font-size: 12px;\n  margin: 0 auto;\n  max-width: 1280px;\n}\n@media only screen and (max-width: 480px) {\n  .mobile-hidden {\n    display: none !important;\n  }\n  .responsive-td {\n    width: 100% !important;\n    display: block !important;\n    padding: 0 !important;\n  }\n}\n.layout-canvas-g > .section > .columns {\n  width: 100%;\n}\n\n</style>\n\n</head>\n<body>\n<div class=\"layout layout-canvas-g\">\n\t<div class=\"section\">\n\t\t<div class=\"columns col1\">\n\t\t\t<div data-type=\"slot\" data-key=\"col1\"></div>\n\t\t</div>\n\t</div>\n</div>\n</body>\n</html>\n","meta":{},"slots":{"col1":{"content":"<div data-type=\"block\" data-key=\"quom960phln\"></div>","design":"<p style=\"font-family:arial;color:#ccc;font-size:11px;text-align:center;vertical-align:middle;font-weight:bold;padding:10px;margin:0;border:#ccc dashed 1px;\">Drop blocks or content here</p>","blocks":{"quom960phln":{"assetType":{"id":197,"name":"htmlblock"},"content":"<table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" role=\"presentation\" style=\"min-width: 100%; \" class=\"stylingblock-content-wrapper\"><tr><td class=\"stylingblock-content-wrapper camarker-inner\"><h1 style=\"color: rgb(32, 32, 32); font-family: arial; font-size: 72px; font-style: normal; font-weight: bold; line-height: 1; text-align: center;\">\n    We found a problem</h1>\n<h2 style=\"color: rgb(32, 32, 32); font-family: arial; font-style: normal; font-weight: bold; line-height: 1; text-align: center;\">\n    <ctrl:eval>Platform.Request.GetQueryStringParameter('error');</ctrl:eval>\n</h2>\n<p style=\"color: rgb(32, 32, 32); font-family: arial; font-style: normal; line-height: 1; text-align: center;\">\n    <ctrl:eval>Platform.Request.GetQueryStringParameter('error_description');</ctrl:eval>\n</p></td></tr></table>","design":"<table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" role=\"presentation\" style=\"min-width: 100%; \" class=\"stylingblock-content-wrapper\"><tr><td class=\"stylingblock-content-wrapper camarker-inner\"><div class=\"default-design\"><div style=\"width:100%;height:150px;background: url(data:image/png;base64,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) repeat-x 0 0\"></div></div></td></tr></table>","meta":{"wrapperStyles":{"mobile":{"visible":true},"styling":{}}},"modelVersion":2}},"modelVersion":2}},"modelVersion":2}}},"content":{"channelTypeId":3,"contentType":"text/html","isDefault":true,"isStaticContent":false,"name":"Unauthorized","siteId":"{{mcpm#/entities/primaryLandingPages/1873880-565/data/definition/landingPageId}}"},"name":"Unauthorized","primaryId":"{{mcpm#/entities/primaryLandingPages/1873880-565/data/id}}","state":{"contentType":"text/html","description":"","name":"Unauthorized","siteId":"{{mcpm#/entities/primaryLandingPages/1873880-565/data/definition/landingPageId}}"}}}},"microsites":{},"micrositePages":{},"micrositePageVersions":{},"primaryLandingPages":{"1873876-564":{"issues":[],"originID":"1873876-564","originEID":"client_base_url","data":{"asset":{"assetType":{"id":205,"name":"webpage"},"name":"DedupHelper (5)","category":{"id":"{{mcpm#/entities/categories/10062/data/id}}"},"contentType":"text/html","meta":{"globalStyles":{"isLocked":false,"body":{"max-width":"1280px"}}},"views":{"html":{"thumbnail":{},"content":"%%[\nVAR @secondQans, @secondQchoiceOne, @secondQchoiceTwo, @MessageStep1, @MessageStep2\nSET @DEfound = RequestParameter(\"DEfound\")\nSET @secondQans = RequestParameter(\"secondQ\")\nSET @session = RequestParameter(\"state\")\n]%%\n<script runat=\"server\">\n    /* -------------------------------------------------------------------------\n\n    Authenticates each visitor to limit access only to SFMC logged-in users.\n\n    1. Global Variables\n    2. Helper Functions\n        2.1. Debugging\n        2.2. Error handling\n    3. Authentication Flow\n        3.1. Authorisation\n        3.2. Authentication with REST Token\n            3.2.1. Build token request payload\n            3.2.2. Request the token\n            3.2.3. Destructure the response\n            3.2.4 Get User Details\n            3.2.5. Upsert Logging Data Extension\n            3.2.6. Handle authentication error\n        3.3. Authorisation Error\n\n    -------------------------------------------------------------------------- */\n\n    Platform.Load('core', '1');\n\n    /* ----------------------------------------------------------------------- */\n    /* ---------------------- 1. GLOBAL VARIABLES ---------------------------- */\n    /* ----------------------------------------------------------------------- */\n    var method = Platform.Request.Method();\n\n    var debugging = false;\n    var appName = 'Dedup Helper';\n    var appURL = 'https://cloud.recruiting.stepstone.de/DedupHelper-v4';\n\n    var clientID = 'client_id';\n    var clientSecret = 'client_secret';\n    var clientBase = 'client_base_url';\n    var authDE = 'DedupHelperAuthLog';\n\n    var state = Platform.Request.GetQueryStringParameter('state');\n    Variable.SetValue(\"@session\",state);\n\n    var errorMessage = Platform.Request.GetQueryStringParameter('error');\n    var errorDescription = Platform.Request.GetQueryStringParameter('error_description');\n    var errorDE = 'DedupErrorLog';\n    var errorURL = 'https://cloud.recruiting.stepstone.de/DedupErrorHandler';\n\n    /* ----------------------------------------------------------------------- */\n    /* ---------------------- 2. HELPER FUNCTIONS ---------------------------- */\n    /* ----------------------------------------------------------------------- */\n\n    /* ---------------------- 2.1. Debugging --------------------------------- */\n\n    /**\n    * @function debugValue\n    * @description Outputs provided description and SSJS value to front-end in a type-safe & consistent way\n    * @param {string} description - Describes meaning of the second parameter in the output\n    * @param {*} value - The value that needs to be debugged\n    */\n    function debugValue(description, value) {\n        Write(description + ': ' + (typeof value == 'object' ? Stringify(value) : value) + '<br><br>');\n    };\n\n    /* ---------------------- 2.2. Error handling ---------------------------- */\n\n    /**\n    * @function handleError\n    * @description Adds the error with context to error logging Data Extension and redirects to error page.\n    * @param {Object} error - The caught error object. Can come from the try/catch block or be manually created.\n    * @param {string} error.message - First error key stores short error message describing the issue.\n    * @param {string} error.description - Second error key stores detailed error path helping with root cause analysis\n    */\n    function handleError(error) {\n        if (debugging) {\n            debugValue('Found error', error);\n        } else {\n            // Remember that if your Logging Data Extension is in Shared Folder, you need to add the \"ENT.\" prefix to name\n            Platform.Function.InsertData(errorDE, ['id', 'appName', 'errorMessage', 'errorDescription'], [GUID(), appName, error.message, error.description]);\n            Platform.Response.Redirect(errorURL + '?error=' + error.message + '&error_description=' + error.description);\n        };\n    };\n  \n    if (method == 'GET') {\n\n        /* ----------------------------------------------------------------------- */\n        /* ---------------------- 3. AUTHENTICATION FLOW ------------------------- */\n        /* ----------------------------------------------------------------------- */\n\n        /* ---------------------- 3.1. Authorization ----------------------------- */\n        if (!state && !errorMessage) {\n            state = GUID();\n            Platform.Response.Redirect('https://' + clientBase + '.auth.marketingcloudapis.com/v2/authorize?response_type=code&client_id=' + clientID + '&redirect_uri=' + appURL + '&state=' + state);\n\n            /* ---------------------- 3.2. Authentication ---------------------------- */\n\n        } else if (state && !errorMessage) {\n            /* 3.2.1. Build token request payload */\n            var code = Platform.Request.GetQueryStringParameter('code');\n            var payload = {\n                grant_type: 'authorization_code',\n                code: code,\n                client_id: clientID,\n                client_secret: clientSecret,\n                redirect_uri: appURL\n            };\n            /* 3.2.2. Request the token */\n            var response = HTTP.Post('https://' + clientBase + '.auth.marketingcloudapis.com/v2/token', 'application/json', Stringify(payload));\n            /* 3.2.3. Destructure the response */\n            if (response.StatusCode == 200) {\n                var parsedResponse = Platform.Function.ParseJSON(response.Response[0]);\n                var accessToken = parsedResponse.access_token;\n                var tokenExpire = Platform.Function.SystemDateToLocalDate(Platform.Function.Now());\n                tokenExpire.setMinutes(tokenExpire.getMinutes() + 18);\n\n                /* 3.2.4. Get User Details */\n                response = HTTP.Get('https://' + clientBase + '.auth.marketingcloudapis.com/v2/userinfo', ['Authorization'], ['Bearer ' + accessToken]);\n                if (debugging) debugValue('UserInfo Response', response)\n                userName = Platform.Function.ParseJSON(response.Content).user.name;\n                userEmail = Platform.Function.ParseJSON(response.Content).user.email;\n\n                /* 3.2.5. Upsert Authentication Logging Data Extension */\n                Platform.Function.UpsertData(authDE, ['session'], [state],\n                    ['appName', 'token', 'tokenExpire', 'userName', 'userEmail'],\n                    [appName, accessToken, tokenExpire, userName, userEmail]\n                );\n\n\n                /* 3.2.6. Handle authentication error */\n            } else {\n                handleError({ message: 'Authentication Failed', description: 'Status: ' + response.StatusCode })\n            };\n\n            /* ---------------------- 3.3. Authorization Error ----------------------- */\n\n        } else {\n            handleError({ message: errorMessage, description: errorDescription });\n        };\n      } else if (method == 'POST') {\n            /* 4.2.1 Get session code from POST url */\n            var session = Request.GetQueryStringParameter(\"state\"); \n            /* 4.2.2. Check whether there is a matching token for the session */\n            var token = Platform.Function.Lookup(authDE, 'token', ['appName', 'session'], [appName, session]);\n            var tokenExpire = Platform.Function.Lookup(authDE, 'tokenExpire', ['appName', 'token'], [appName, token]);\n            /* 4.2.3. If no valid token, return error */\n            if (Platform.Function.SystemDateToLocalDate(Platform.Function.Now()) > tokenExpire) {\n                handleError({ message: 'Session Timeout', description: 'The token is expired. Please refresh the session to use the application.' });\n            };        \n      }\n</script>\n\n<!-- The Cloud Page App micro SSO solution will secure anything you create below -->\n\n<script runat=\"server\">\n  Platform.Load(\"core\",\"1\");\n  var DEfound = false;\n  var secondQans = Variable.GetValue(\"@secondQans\");\n                         \n  // Check if the form is submitted  \n  if (method == \"POST\" && !DEfound && !secondQans) { \n    var message = '';\n    var DEprop = Request.GetQueryStringParameter(\"DEprop\");\n    var DEval = Request.GetQueryStringParameter(\"DEval\");\n    var FindDE = DataExtension.Retrieve({Property:DEprop,SimpleOperator:\"equals\",Value:DEval});\n    \n    if(FindDE.length == 1){\n      message += 'Your Filtered DE is located at: ';\n    } else if(FindDE.length > 1){\n      message += 'We have found more than one DE with the same name, please enter the correct name of your DE & click on locate button <br><br>';\n      message += 'The location of your ' + FindDE.length + ' Data Extensions are below: <br><br>';\n    } else {\n      message += 'Sorry a DE with that name does not exist, please re-check your entry'; \n    };  \n    \n    for (var i = 0; i < FindDE.length; i++) {\n      var FolderID = FindDE[i].CategoryID;\n      var FilterDEFolderUrl = 'https://mc.s51.exacttarget.com/cloud/#app/Email/C12/Default.aspx?entityType=none&entityID=0&ks=ks%23Subscribers/CustomObjects/'+FolderID;\n      var DEname = FindDE[i].Name;\n      var DEobjectId = FindDE[i].ObjectID;\n\n      Variable.SetValue(\"@FolderID\",FolderID);\n      Variable.SetValue(\"@FolderUrl\",FilterDEFolderUrl);\n      Variable.SetValue(\"@DEname\",DEname);\n      Variable.SetValue(\"@DEobjectId\",DEobjectId);\n\n      if (FindDE.length == 1) {\n        var newDEName = DEname+'_Dedup_' + formatDate(new Date());\n        Variable.SetValue(\"@newDEName\",newDEName);\n        DEfound = true;\n        Variable.SetValue(\"@DEfound\",DEfound);\n        var list = getFolderPath(DEname, FolderID);   \n        if (list.length > 1){\n          message += list.join(\"> \") +'<br><br><br>';\n        }\n      } else if (FindDE.length > 1) {\n        var list = getFolderPath(DEname, FolderID);                         \n        if (list.length > 1){\n          var deNum = +i +1;\n          message += 'DE '+ deNum +' is located at: ';\n          message += list.join(\"> \") +'<br><br><br>';\n        }                                    \n      };\n    };  \n    \n    Variable.SetValue(\"@MessageStep1\",message);\n  }\n  \n  if (Request.Method == \"POST\" && secondQans == \"answered\") {\n    var message = '';\n    var objectId = Request.GetQueryStringParameter(\"DEobjectId\");\n    var newDEName = Request.GetQueryStringParameter(\"newDEName\"); \n    var FolderID = Request.GetQueryStringParameter(\"FolderID\");\n    var DEname = Request.GetQueryStringParameter(\"DEname\"); \n    var FolderUrl = Request.GetQueryStringParameter(\"FolderUrl\");\n    Variable.SetValue(\"@FolderUrl\",FolderUrl);\n \n\n    //Find Filtered DE fields\n    var FindDE = DataExtension.Retrieve({Property:\"Name\",SimpleOperator:\"equals\",Value:DEname});\n    var DEcustomerKey = FindDE[0].CustomerKey;\n    var isSendable = FindDE[0].IsSendable;                             \n    var sendableDEField = FindDE[0].SendableDataExtensionField;\n    var sendableSubField = FindDE[0].SendableSubscriberField;                   \n\n    message += '<br><br><br>';\n    message +='<b>Helpful Information</b>';\n    message +='<br><br><br>';\n    \n    var prox = new Script.Util.WSProxy();\n    prox.setClientId({\"ID\": Platform.Function.AuthenticatedMemberID()});                            \n    var DE = DataExtension.Init(DEcustomerKey);\n    var custKeyOfExistingDE = dataExtensionExists(newDEName);\n    if (custKeyOfExistingDE) {\n      deleteDE(custKeyOfExistingDE);\n    }            \n    var fields = DE.Fields.Retrieve();\n    for(var i = 0; i < fields.length; i++) {\n      if(fields[i]['IsPrimaryKey'] == true ) fields[i]['IsRequired'] = true;\n    }\n    var NewCustomerKey = Platform.Function.GUID();\n    var ClonedDE = {\n      'CustomerKey' : NewCustomerKey,\n      'Name' : newDEName,\n      'CategoryID': FolderID,\n      'IsSendable': isSendable,\n      'Fields' : fields,\n      'DataRetentionPeriodLength': 60,\n      'DataRetentionPeriod': 'Days',\n      'RowBasedRetention': false,\n      'ResetRetentionPeriodOnImport': true,                                \n      'SendableDataExtensionField' : sendableDEField,\n      'SendableSubscriberField' : {\"Name\": \"Subscriber Key\"}\n    }\n    \n    var res = prox.createItem(\"DataExtension\", ClonedDE);\n    if(res.Results[0].StatusCode == \"OK\"){\n      message += '<i>The name of your deduplicated DE is:</i> \\n\\n' + newDEName +'<br><br>'; \n      message += '<i>You can find this DE at the <a href=\"'+FolderUrl+'\" target=\"_blank\">folder</a> location:</i> \\n\\n'; \n      var list = getFolderPath(newDEname, FolderID);                        \n      if (list.length > 1){ \n         message += list.join(\"> \") + '<br><br>';\n      }                                \n    } else {\n      message += res.Results[0].StatusCode + \": \" + res.Results[0].StatusMessage;;\n    }\n\n    /* Create and run SQL query to dedup DE */\n    var dedupQueryKey = Platform.Function.GUID();\n    var selectQueryParams = getQueryParams(fields, 'x.');\n    var selectFromFields =  getQueryParams(fields);\n    var dedupQuery = \"SELECT  \" + selectQueryParams + \" FROM (SELECT ROW_NUMBER() OVER (partition by Email ORDER BY  CONVERT(DATETIME2, RelationLastModifiedDate) DESC) AS NewRowNumber, \" + selectFromFields + \" FROM [\" + DEname + \"]) x WHERE x.NewRowNumber = 1\";\n\n    var createStatus = createQuery(dedupQueryKey, dedupQuery, NewCustomerKey,'Update');\n    \n    if(createStatus.Status == \"OK\"){\n      message += '<i>We are ready to launch the SQL query to deduplicate your filtered DE..</i> <br><br>';\n    } else {\n      message += '(+) Query create ' + Platform.Function.Stringify(createStatus) + '<br><br>';\n    }\n    \n    var queryObjectID = createStatus.Results[0].NewObjectID;\n    var performStatus = performQuery(queryObjectID);\n    \n    if(performStatus.Status == \"OK\"){\n      message += '<i>Query is running now. Please wait a couple of minutes for it to finish. You shall see deduplicated records in the '+newDEName+' soon</i> <br><br>';\n    }else{\n      message += '(+) Query perform ' + Platform.Function.Stringify(performStatus) + '<br><br>';\n    }                            \n    //sleep(30000); // wait for query to finish\n    //var removeStatus = removeQuery(queryObjectID);\n    //Write('(+) Query remove ' + Platform.Function.Stringify(removeStatus) + '\\n\\n');\n    Variable.SetValue(\"@MessageStep2\",message);\n  }\n  \n\n  /* Creates a date string in ddmmyyyy format */\n  function formatDate(date) {\n    var d = new Date(date), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();\n    if (month.length < 2) month = '0' + month;\n    if (day.length < 2) day = '0' + day;\n    var formattedDate = day + month + year;\n    return formattedDate\n  } \n  \n  //Get the DE folder path\n  function getFolderPath(DEname, FolderID){\n    var list = [];\n    var path = function(id) {\n      if (id > 0) {\n        var results = Folder.Retrieve({Property:\"ID\",SimpleOperator:\"equals\",Value:id});\n        list.unshift(results[0].Name);\n        return path(results[0].ParentFolder.ID);\n      }\n      else {\n        return id;\n      }\n    }\n    list.push(DEname);\n    path(FolderID);\n    return list;\n  } \n  \n   /* Create a query using WSProxy */\n  function createQuery(queryKey, queryText, targetDEKey, targetUpdateType) {\n    var queryConfig = {\n      Name: queryKey,\n      CustomerKey: queryKey,\n      TargetUpdateType: targetUpdateType,\n      TargetType: 'DE',\n      DataExtensionTarget: {\n        Name: targetDEKey,\n        CustomerKey: targetDEKey\n      },\n      QueryText: queryText\n    };\n    var status = prox.createItem('QueryDefinition', queryConfig);\n    return status;\n  }\n  /* Perform a query using WSProxy (ObjectID is needed) */\n  function performQuery(queryObjID) {\n    var prox = new Script.Util.WSProxy();\n    var props = {\n      ObjectID: queryObjID\n    };\n    var action = 'Start';\n    var opts = {};\n    var status = prox.performItem('QueryDefinition', props, action, opts);\n    return status;\n  }  \n  /* Remove a query using WSProxy (ObjectID is needed) */\n  function removeQuery(queryObjID) {\n    var prox = new Script.Util.WSProxy();\n    var props = {\n      ObjectID: queryObjID\n    };\n    var status = prox.deleteItem('QueryDefinition', props);\n    return status;\n  }          \n  /* Wait function */\n  function sleep(milliseconds) {\n    var start = new Date().getTime();\n    for (var i = 0; i < 1e7; i++) {\n      if (new Date().getTime() - start > milliseconds) {\n        break;\n      }\n    }\n  } \n  /* Delete a DE (using customer key) */\n  function deleteDE(deleteDECustomerKey){\n    var prox = new Script.Util.WSProxy();\n    var req = prox.retrieve(\"DataExtension\", [\"ObjectID\"], {\n      Property: \"DataExtension.CustomerKey\", SimpleOperator: \"equals\", Value: deleteDECustomerKey }\n                           );\n    var objectId = req.Results[0].ObjectID;\n    var result = prox.deleteItem(\"DataExtension\", {\n      \"ObjectID\": objectId });    \n  }  \n  /* Check whether a DE with same name exists already(using DE name) */\n  function dataExtensionExists(deName){\n    var findExistingDE = DataExtension.Retrieve({\n      Property:\"Name\",SimpleOperator:\"equals\",Value:deName}\n                                               );\n    //Write(\"Found Existing DE: \"+Stringify(findExistingDE)+ \"<br>\");\n    if (findExistingDE[0].CustomerKey.length > 0){\n      //Write(\"DE cust key: \"+findExistingDE[0].CustomerKey+ \"<br>\");\n      return findExistingDE[0].CustomerKey;\n    }\n  }\n\n  // Helper function to build the select query \n  // param fields - array of results return by DE.Fields.Retrieve();\n  // param prefix - an optional string to be added before each field nameield name\n  // return all the fields name from the DE as a single string like \"field1, field2, field3\"\n  function getQueryParams(fields, prefix){\n    if (fields && fields.length){\n      var params = [];\n      var prefix = (typeof prefix === \"string\" && prefix) || '';\n      for(var i=0; i < fields.length; i++){\n        if(fields[i].Name) params.push(prefix + fields[i].Name);\n      }\n      return params.join(',');\n    } \n  }\n</script>\n\n<!DOCTYPE html> \n<html>\n<head>\n <meta http-equiv=\"Cache-Control\" content=\"no-store,no-cache, must-revalidate,post-check=0, pre-check=0,max-age=0\">\n      <meta http-equiv=\"Pragma\" content=\"no-cache\">\n      <meta http-equiv=\"Expires\" content=\"0\">\n      <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n      <meta name=\"sg:pagetag\" content=\"\">\n      <meta name=\"sg:flowtag\" content=\"\">\n      <meta charset=\"utf-8\">\n      <title>Stepstone.de</title>\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n      <!--<link rel=\"icon\" type=\"image/x-icon\" href=\"images/stepstone.ico\">-->\n      <!-- Bootstrap CSS -->\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\"> \n      <!-- Custom css -->\n<link rel=\"stylesheet\" href=\"https://client_base_url.pub.sfmc-content.com/kdfrm3ji4h3\">\n<link rel=\"stylesheet\" href=\"https://client_base_url.pub.sfmc-content.com/hulsf24n4ub\">\n  \n  <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/styles/salesforce-lightning-design-system.min.css?v=1\">\n  <link rel=\"stylesheet\" type=\"text/css\" href=\"mc/css/styles.css?v=1\">\n<style>\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n</style>  \n</head>\n<body class=\"d-flex flex-column vh-100\">\n      <div id=\"spinner-overlay\" style=\"display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;\">\n        <div style=\"border: 8px solid #f3f3f3; border-top: 8px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;\"></div>\n      </div>  \n      <main class=\"flex-shrink-0\" lang=\"en\">\n         <div class=\"container\">\n            <div class=\"row\">\n               <div class=\"col-md-8 plr-16\">\n                  <table style=\"padding: 20px;\">\n                    <tr>\n                      <td>\n                        <h2>Dedupliction tool</h2>\n                        <br>\n                        <b>Perform the following 2 steps to generate your target Data Extension, deduplicated based on Email Address\n                        </b><br><br>\n                        %%[IF @secondQans == \"answered\" THEN]%%\n                        <b>Step 1: Completed!\n                        </b>                        \n                        %%[ELSE]%%\n                        <b>Step 1: Please enter the name or external key key of the Filtered DE you wish to deduplicate & hit the 'Locate' button\n                        </b>\n                        <br><br>                                                \n                        <form action=\"%%=RedirectTo(CONCAT(CloudPagesURL(560),'?state=',@session))=%%\" method=\"post\">\n                          <select name=\"DEprop\">\n                            <option value=\"Name\">Name</option>      \n                            <option value=\"CustomerKey\">External Key</option>\n                          </select>\n                          equals\n                          <input type=\"text\" name=\"DEval\" value=\"\" maxlength=\"128\">\n                          <br><br>\n                          <input type=\"submit\" value=\"Locate\">\n                        </form>\n                        %%[ENDIF]%%\n                        <br> \n                        %%=v(@MessageStep1)=%%\n                          %%[IF @DEfound == \"true\" AND @secondQans != \"answered\" THEN]%%\n                              <b>Step 2: Have you refreshed your Data Extension: '%%=v(@DEname)=%%' lately? If not please go to the <a href=\"%%=RedirectTo(@FolderUrl)=%%\" target=\"_blank\">folder</a> location & refresh the filtered Data Extension. Once done please hit the 'Proceed' button to create your deduplicated Data Extension\n                              </b><br><br>                                                \n                              <form action=\"%%=RedirectTo(CONCAT(CloudPagesURL(560),'?state=',@session))=%%\" method=\"post\" id=\"secondForm\">\n                                <input type=\"hidden\" name=\"secondQ\" value=\"answered\" />\n                                <input type=\"hidden\" name=\"DEfound\" value=\"true\" />\n                                <input type=\"hidden\" name=\"FolderUrl\" value=\"%%=v(@FolderUrl)=%%\" />\n                                <input type=\"hidden\" name=\"DEobjectId\" value=\"%%=v(@DEobjectId)=%%\" />\n                                <input type=\"hidden\" name=\"FolderID\" value=\"%%=v(@FolderID)=%%\" />\n                                <input type=\"hidden\" name=\"newDEName\" value=\"%%=v(@newDEName)=%%\" />\n                                <input type=\"hidden\" name=\"DEname\" value=\"%%=v(@DEname)=%%\" />\n                                <input type=\"submit\" value=\"Proceed\" id=\"proceedButton\">                                \n                              </form>                          \n                         %%[ENDIF]%%\n                         %%[IF @DEfound == \"true\" AND @secondQans == \"answered\" THEN]%%\n                          <br><br> \n                          <b>Step 2: We are proceeding with the deduplication exercise\n                          </b><br><br>                                                                      \n                         %%[ENDIF]%%   \n                         %%=v(@MessageStep2)=%%\n                      </td>\n                    </tr>\n                  </table>\n               </div>\n            </div>\n         </div>\n      </main>\n<!-- Spinner JS -->\n<script>\n  document.getElementById('proceedButton').addEventListener('click', function (event) {\n    // Display the spinner overlay\n    document.getElementById('spinner-overlay').style.display = 'flex';\n  });\n</script>   \n</body>\n</html>\n","meta":{},"slots":{"col1":{"design":"<p style=\"font-family:arial;color:#ccc;font-size:11px;text-align:center;vertical-align:middle;font-weight:bold;padding:10px;margin:0;border:#ccc dashed 1px;\">Drop blocks or content here</p>","modelVersion":2}},"modelVersion":2}}},"content":{"channelTypeId":3,"contentType":"text/html","isDefault":true,"isStaticContent":false,"name":"DedupHelper"},"definition":{"categoryId":"{{mcpm#/entities/cloudPageCollections/25856/data/id}}","domain":"{{mcpm:cloudPages-domain}}","isNoFollow":true,"isNoIndex":true,"key":"DedupHelper-v4","name":"DedupHelper-v4","pageTypeId":3,"requiresSsl":true,"url":"https://cloud.recruiting.stepstone.de/DedupHelper-v4"},"name":"DedupHelper-v4","state":{"contentType":"text/html","description":"","name":"DedupHelper"}}},"1873880-565":{"issues":[],"originID":"1873880-565","originEID":"client_base_url","data":{"asset":{"assetType":{"id":205,"name":"webpage"},"name":"Unauthorized (1)","category":{"id":"{{mcpm#/entities/categories/10062/data/id}}"},"contentType":"text/html","meta":{"globalStyles":{"isLocked":false,"body":{"max-width":"1280px","color":"#000000","font-family":"Arial","font-size":"12px","margin":"0px auto"},"template":{"background-color":"#FFFFFF","border":"none","box-sizing":"border-box","padding":"0px","width":"100%"},"buttons":{},"h1":{},"h2":{},"h3":{},"links":{}}},"views":{"html":{"thumbnail":{},"content":"<!DOCTYPE html>\n<html>\n<head>\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0\" />\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\t<style class=\"main_style\">\n.layout-canvas-g {\n  background-color: #fff;\n  border: none;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  padding: 0;\n  width: 100%;\n}\n.layout-canvas-g > .header,\n.layout-canvas-g > .section,\n.layout-canvas-g > .footer {\n  position: relative;\n  overflow: hidden;\n  width: 100%;\n  word-wrap: break-word;\n}\n.layout-canvas-g > .section {\n  margin: 10px 0;\n}\n.layout-canvas-g > .section > .columns {\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  word-wrap: break-word;\n}\nbody {\n  color: #000;\n  font-family: Arial;\n  font-size: 12px;\n  margin: 0 auto;\n  max-width: 1280px;\n}\n@media only screen and (max-width: 480px) {\n  .mobile-hidden {\n    display: none !important;\n  }\n  .responsive-td {\n    width: 100% !important;\n    display: block !important;\n    padding: 0 !important;\n  }\n}\n.layout-canvas-g > .section > .columns {\n  width: 100%;\n}\n\n</style>\n\n</head>\n<body>\n<div class=\"layout layout-canvas-g\">\n\t<div class=\"section\">\n\t\t<div class=\"columns col1\">\n\t\t\t<div data-type=\"slot\" data-key=\"col1\"></div>\n\t\t</div>\n\t</div>\n</div>\n</body>\n</html>\n","meta":{},"slots":{"col1":{"content":"<div data-type=\"block\" data-key=\"quom960phln\"></div>","design":"<p style=\"font-family:arial;color:#ccc;font-size:11px;text-align:center;vertical-align:middle;font-weight:bold;padding:10px;margin:0;border:#ccc dashed 1px;\">Drop blocks or content here</p>","blocks":{"quom960phln":{"assetType":{"id":197,"name":"htmlblock"},"content":"<table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" role=\"presentation\" style=\"min-width: 100%; \" class=\"stylingblock-content-wrapper\"><tr><td class=\"stylingblock-content-wrapper camarker-inner\"><h1 style=\"color: rgb(32, 32, 32); font-family: arial; font-size: 72px; font-style: normal; font-weight: bold; line-height: 1; text-align: center;\">\n    We found a problem</h1>\n<h2 style=\"color: rgb(32, 32, 32); font-family: arial; font-style: normal; font-weight: bold; line-height: 1; text-align: center;\">\n    <ctrl:eval>Platform.Request.GetQueryStringParameter('error');</ctrl:eval>\n</h2>\n<p style=\"color: rgb(32, 32, 32); font-family: arial; font-style: normal; line-height: 1; text-align: center;\">\n    <ctrl:eval>Platform.Request.GetQueryStringParameter('error_description');</ctrl:eval>\n</p></td></tr></table>","design":"<table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" role=\"presentation\" style=\"min-width: 100%; \" class=\"stylingblock-content-wrapper\"><tr><td class=\"stylingblock-content-wrapper camarker-inner\"><div class=\"default-design\"><div style=\"width:100%;height:150px;background: url(data:image/png;base64,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) repeat-x 0 0\"></div></div></td></tr></table>","meta":{"wrapperStyles":{"mobile":{"visible":true},"styling":{}}},"modelVersion":2}},"modelVersion":2}},"modelVersion":2}}},"content":{"channelTypeId":3,"contentType":"text/html","isDefault":true,"isStaticContent":false,"name":"Unauthorized"},"definition":{"categoryId":"{{mcpm#/entities/cloudPageCollections/25856/data/id}}","description":"","domain":"{{mcpm:cloudPages-domain}}","isNoFollow":false,"isNoIndex":false,"key":"DedupErrorHandler","name":"UnauthorizedorError","pageTypeId":3,"requiresSsl":true,"url":"https://cloud.recruiting.stepstone.de/DedupErrorHandler"},"name":"UnauthorizedorError","state":{"contentType":"text/html","description":"","name":"Unauthorized"}}}},"queryActivities":{},"registeredCustomActivities":{},"scriptActivities":{},"sendDefinitions":{},"sharedDataExtensions":{},"siteMapVersions":{},"subscriberLists":{},"verificationActivities":{}},"selectedEntities":{"assets":[],"attributeGroups":[],"automations":[],"cloudPageCollections":["25856"],"dataExtensions":["2f4c4abf-61b8-ef11-ba5c-f40343e97c48","115c2c04-60b8-ef11-ba5c-f40343e97c48"],"journeys":[],"journeyTemplates":[],"sharedDataExtensions":[]}}